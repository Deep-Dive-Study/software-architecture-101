“모듈성”은 일관성이 없으며 정의하기 쉽지 않은 개념이다.

개발 플랫폼에서 아키텍처에 있는 도구가 모듈성에 기반하기에, 모듈성과 내부 구현 코드를 이해하는 것은 아키텍트에게 중요한 일이다. 따라서 모듈성을 잘 유지하는 것은 암묵적 아키텍처 특성이라고 정의한 것의 좋은 예가 된다.

# 1. 정의

- 모듈: 복잡한 구조를 만드는 데 쓰이는 각각의 표준화한 부품이나 독립적인 단위

프로그래밍 언어는 대부분 모듈성 메커니즘을 제공하고, 개발자는 연관된 코드를 함께 묶을 때 모듈을 사용한다.

아키텍트는 개발자가 코드를 어떻게 패키징하는지 알아야 한다.

- 모듈 구분
    - 논리적: ex. 클래스, 함수처럼 코드를 묶어 놓은 덩어리
    - 물리적: ex. 자바 패키지 구조(클래스 파일의 물리적인 디렉터리 구조)

# 2. 모듈성 측정

- 핵심 개념 3가지: 응집, 커플링, 커네이선스

## 1) 응집

- 응집(cohesion): 모듈의 파트가 동일한 모듈 안에 얼마나 포함되어 있는지를 나타낸다.

컴퓨터 과학자들은 응집도 측정 범위를 정의했다.

- (가장 좋은 것 → 나쁜 것 순)
    - 기능적 응집
        - 모듈의 각 파트는 다른 파트와 연관되어 있고 기능상 꼭 필요한 모든 것이 모듈 내에 있다.
    - 순차적 응집
        - 두 모듈이, 한 쪽이 데이터를 출력하면 다른 한쪽이 그것을 입력 받는 형태로 상호작용
    - 소통적 응집
        - 두 모듈이, 각자 정보에 따라 작동하고 어떤 출력을 내는 형태로 통신 체인을 형성
    - 절차적 응집
        - 두 모듈은 정해진 순서대로 실행되어야 한다
    - 일시적 응집
        - 시점 의존성에 따라 연관
    - 논리적 응집
        - 모듈의 내부 데이터는 기능적이 아니라, 논리적으로 연관되어 있다.
        - ex. 텍스트, 직렬화 객체, 스트림 형태로 받은 데이터를 변환하는 모듈
    - 동시적 응집
        - 같은 소스 파일에 모듈 구성 요소가 들어있지만 그 외에는 아무 연관성이 없다.

컴퓨터 과학자들은 응집도를 가늠할 수 있는 구조적 메트릭을 개발했다.

- 메서드의 응집 결여도 (LCOM; Lack of Cohesion in Methods)
    - 공유 필드를 통해 공유되지 않는 메서드의 총 개수
- 버전1
    - P: 특정 공유 필드에 액세스하지 않는 메서드 수만큼 증가
    - Q: 특정 공유 필드를 공유하는 메서드 수만큼 감소
- 버전2 (LCOM96b)
    - private field a, b가 있는 클래스가 있다고 했을 때 각 필드 a, b를 액세스하는 메서드가 있다고 하자.
    - → 공유 필드를 통해 공유되지 않는 메서드는 많기 때문에 이 클래스의 LCOM 점수가 높다.

LCOM 메트릭은 아키텍처 스타일을 전환하기 위해 코드베이스를 분석하는 아키텍트에게 매우 유용하다.

소프트웨어 메트릭은 대부분 한두가지 중요한 결함을 안고 있는데, LCOM의 모든 메트릭이 찾아내는 것은 ‘구조적’ 응집 결여도일 뿐, 메트릭만으로 어떤 조각들이 서로 잘 맞는지 논리적으로 판단할 수 없다.

## 2) 커플링

코드베이스의 커플링은 그래프 이론에 기반한 좋은 분석 도구들이 많다.

- 구심 커플링: 코드 아티팩트로 유입되는 접속 수
- 원심 커플링: 다른 코드 아티팩트로 유출되는 접속 수

## 3) 추상도, 불안정도, 메인 시퀀스로부터의 거리

- 추상도
    - 추상 아티팩트(추상 클래스, 인터페이스)와 구상 아티팩트(구현체)의 비율
- 불안정도
    - 원심 커플링과 (구심 커플링 + 원심 커플링)의 비율
    - 변동성을 의미한다. 불안정도가 높은 코드베이스는 변경 시 커플링이 높아 더 깨지기 쉽다.

## 4) 메인 시퀀스로부터의 거리

- 메인 시퀀스로부터의 거리
    - 아키텍처 구조를 평가하는 몇 가지 전체적인 메트릭 중 하나
    - 불안정도와 추상도를 이용하여 계산한다.

<img width="368" height="291" alt="image" src="https://github.com/user-attachments/assets/2a424fe9-f364-45a1-8ada-a3c9aa55784e" />


이상적인 선에 가까울수록 클래스 균형이 잘 맞는다는 방증이다.

<img width="382" height="316" alt="image" src="https://github.com/user-attachments/assets/3012cef5-e5bc-4ee4-8d19-2aff2e388a2b" />


오른쪽 위로 치우친 부분은 쓸모없는 구역, 왼쪽 아래로 치우친 부분은 고통스런 구역이다.

**메트릭의 한계**

코드 구조와 직접적으로 연관된 메트릭조차 해석이 필요하다.

예를 들어 근본적 복잡도와 우발적 복잡도는 구별할 방법이 없다.

코드 레벨의 메트릭은 거의 다 주관적이지만, 순환 복잡도처럼 중요한 메트릭은 아키텍트가 평가할 수 있도록 베이스라인을 정해두는게 좋다.

## 5) 커네이선스

밀러페이지 존스 “두 컴포넌트 중 한쪽이 변경될 경우 다른 쪽도 변경해야 전체 시스템의 정합성이 맞는다면 이들은 커네이선스를 갖고 있는 것이다.“

밀러페이지 존스는 커네이선스를 정적/동적으로 분류했다.

- 정적 커네이선스
    - 명칭 커네이선스(CoN)
        - 여러 컴포넌트의 엔티티명이 일치해야 한다.
    - 타입 커네이선스(CoT)
        - 여러 컴포넌트의 엔티티 타입이 일치해야 한다.
    - 의미 커네이선스(CoM) 또는 관례 커네이선스(CoC)
        - 여러 컴포넌트에 걸쳐 어떤 값의 의미가 일치해야 한다.
    - 위치 커네이선스(CoP)
        - 여러 컴포넌트는 값의 순서가 일치해야 한다.
    - 알고리즘 커네이선스(CoA)
        - 여러 컴포넌트는 특정 알고리즘이 일치해야 한다.
        - ex. 서버/클라이언트 둘 다 실행되어야 하고 유저 인증 시 반드시 동일한 결과를 내야 하는 보안 해시 알고리즘
- 동적 커네이선스
    - 실행 커네이선스(CoE)
        - 여러 컴포넌트의 실행 순서가 중요하다.
    - 시점 커네이선스(CoT)
        - 여러 컴포넌트의 실행 시점이 중요하다.
        - ex. 동시에 실 중인 두 스레드 때문에 경합 조건이 발생하여 공동 작업의 결과에 영향을 끼치는 것
    - 값 커네이선스(CoV)
        - 상호 연관된 다수의 값들을 함께 변경했을 때 발생한다.
        - ex. 트랜잭션
    - 식별 커네이선스(Col)
        - 여러 컴포넌트가 동일한 엔티티를 참조할 때 발생한다.
        - ex. 독립적인 두 컴포넌트가 분산 큐 같은 자료구조를 공유해서 업데이트하는 경우

[]()

- 커네이선스 속성
    - 커네이선스 속성을 잘 활용하면 개발자에게 큰 도움이 된다.
    - 강도
        - 아키텍트는 개발자 어떤 유형의 커네이선스를 얼마나 쉽게 리팩터링할 수 있는지에 따라 커네이선스 강도를 결정한다.
        - 정적 커네이선스를 선호한다.
            - 개발자가 간단히 소스 코드를 분석하거나 최신 도구를 활용하면 어렵잖게 개선할 수 있기 때문에 아키텍트는 동적 커네이선스보다 정적 커네이선스를 선호한다.
    - 지역성
        - 코드베이스의 모듈들이 서로 얼마나 가까이 있는가를 의미한다.
        - 근접한 코드는 보통 더 분리된 코드보다 높은 형태의 커네이선스를 가진다.
        - 모듈을 서로 떨어뜨렸을 때 커플링이 형편없는 형태의 커네이선스는 모듈을 서로 가까이 붙여 놓는 식으로 개선할 수 있다.
    - 정도
        - 커네이선스가 미치는 영향의 규모
        - 값이 작을수록 코드베이스 입장에서 바람직하다.
        - 모듈이 몇 개 안된다면 동적 커네이선스가 높아도 별로 해롭지 않지만, 일반적으로 코드베이스는 점점 커진다.

짐 웨이리치는 커네이선스 개념을 다시 대중화하면서 두 가지 조언을 남겼다.

- 정도의 규칙
    - 강한 형태의 커네이선스를 보다 약한 형태의 커네이선스로 전환하라.
- 지역성의 규칙
    - 소프트웨어 엘리먼트 간의 거리가 멀어질수록 보다 약한 형태의 커네이선스를 사용하라.

## 6) 커플링과 커네이선스 메트릭을 통합

구조적 프로그래밍은 유출/유입에 관심이 있는 반면, 커네이선스는 여러 가지 요소가 서로 어떻게 커플링되는지에 주목한다.

<img width="596" height="263" alt="image" src="https://github.com/user-attachments/assets/0b323064-76aa-4792-ad0c-f4f9e077c479" />


# 3. 모듈에서 컴포넌트로

책에서는 연관된 코드의 묶을을 “모듈”이라는 일반 용어로 표현한다. 하지만 대부분 플랫폼은 소프트웨어 아키텍트에게 핵심 구성 요소 중 하나인 “컴포넌트” 형태로 지원한다.

논리적, 물리적 분리에 관한 개념과 그에 따른 분석은 컴퓨터 과학 초창기부터 존재했지만, 아직도 컴포넌트와 분리에 관한 수많은 글과 의견들이 쏟아져 나오고 있는 가운데 개발자와 아키텍트는 좋은 결과를 내기 위해 애쓰고 있다.
